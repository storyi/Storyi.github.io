
<!DOCTYPE html>
<html lang class="loading">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>zookeeper - Hexo</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <meta name="keywords" content="TriDiamond Obsidian,"> 
    <meta name="description" content="Zookeeper：
分布式系统：是一个硬件或软件组建分布在网络中的不同计算机之上，彼此间仅通过消息传递进行通信和协作的系统

特性：
    分布式、对等性、并发性、缺乏全局时钟、故障必然会发生
,"> 
    <meta name="author" content="John Doe"> 
    <link rel="alternative" href="atom.xml" title="Hexo" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    <link href="https://fonts.loli.net/css?family=Roboto+Mono|Rubik&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_1429596_nzgqgvnmkjb.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.7.2/animate.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/codemirror.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/theme/dracula.css">
    <link rel="stylesheet" href="/css/obsidian.css">
    <link rel="stylesheet" href="/css/ball-atom.min.css">
</head>
</html>

<body class="loading">
    <div class="loader">
        <div class="la-ball-atom la-2x">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <span id="config-title" style="display:none">Hexo</span>
    <div id="loader"></div>
    <div id="single">
    <div class="scrollbar gradient-bg-rev"></div>
<div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <div class="navigation animated fadeIn fast delay-1s">
        <img id="home-icon" class="icon-home" src="/img/favicon.png" alt="" data-url="http://yoursite.com">
        <div id="play-icon" title="Play/Pause" class="iconfont icon-play"></div>
        <h3 class="subtitle">zookeeper</h3>
        <div class="social">
            <!--        <div class="like-icon">-->
            <!--            <a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
            <!--        </div>-->
            <div>
                <div class="share">
                    
                        <a href="javascript:;" class="iconfont icon-share1"></a>
                        <div class="share-component-cc" data-disabled="facebook,douban,linkedin,diandian,tencent,google"></div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

    <div class="section">
        <div class=article-header-wrapper>
    <div class="article-header">
        <div class="article-cover animated fadeIn" style="
            animation-delay: 600ms;
            animation-duration: 1.2s;
            background-image: 
                radial-gradient(ellipse closest-side, rgba(0, 0, 0, 0.65), #100e17),
                url(/img/cover.jpg) ">
        </div>
        <div class="else">
            <p class="animated fadeInDown">
                
                <a href="/categories/开源软件"><b>「
                    </b>开源软件<b> 」</b></a>
                
                August 13, 2019
            </p>
            <h3 class="post-title animated fadeInDown"><a href="/2019/08/13/zookeeper/" title="zookeeper">zookeeper</a>
            </h3>
            
            <p class="post-count animated fadeInDown">
                
                <span>
                    <b class="iconfont icon-text2"></b> <i>Words count</i>
                    4.6k
                </span>
                
                
                <span>
                    <b class="iconfont icon-timer__s"></b> <i>Reading time</i>
                    4 mins.
                </span>
                
                
                
                <span id="busuanzi_container_page_pv">
                    <b class="iconfont icon-read"></b> <i>Read count</i>
                    <span id="busuanzi_value_page_pv">0</span>
                </span>
                
            </p>
            
            
            <ul class="animated fadeInDown post-tags-list"><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/zookeeper/">zookeeper</a></li><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/集群/">集群</a></li></ul>
            
        </div>
    </div>
</div>

<div class="screen-gradient-after">
    <div class="screen-gradient-content">
        <div class="screen-gradient-content-inside">
            <div class="bold-underline-links screen-gradient-sponsor">
                <p>
                    <span class="animated fadeIn delay-1s"></span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="article">
    <div class='main'>
        <div class="content markdown animated fadeIn">
            <p>Zookeeper：</p>
<pre><code>分布式系统：是一个硬件或软件组建分布在网络中的不同计算机之上，彼此间仅通过消息传递进行通信和协作的系统

特性：
    分布式、对等性、并发性、缺乏全局时钟、故障必然会发生

典型问题    
    通信异常、网络分区、三态（成功、失败、超时）、节点故障

CAP：2000.7，Erlc Brewer，ACM PODC (提出)
     2002    MIT,Seth Gilbert, Nancy Lynch ;

    P：网络分区容错性：
         CP：一致性
         AP：可用性

BASE:
    BA：基本可用(存在不可预知的故障时允许损失部分可用性)
    S：软状态(允许接受一定时间延迟)
    E：最终一致性
        因果一致性、会话一致性、单调读一致性、单调写一致性、读已之所写一致性

保证分布式系统的一致性协议：
    2PC：2 Phase-Commit  请求和执行(先发请求会被堵塞，需要等最后请求才能开始第二阶段)
    3PC：3 Phase-Commit  CanCommit-&gt;PreCommit--&gt;Docommit （只有法请求的在会被堵塞）
    Paxos：Leslie Lamport ,1990年提出，
    ETCD分布式协议

    Google Chubby，分布式锁服务，GFS/BigTable都用到了chubby
        分布式协作、元数据存储、Master选举；

HDFS/HBase，Zookeeper

    zookeeper是一个开源的分布式协调服务，由知名互联网公司Yahoo创建，它是Chubby的开源实现；zk是一个典型的分布式数据一致性解决方案，分布式应用程序可以基于它实现数据的发布/订阅、负载均衡、名称服务、分布式协调/通知、集群管理、Master选举、分布式锁和分布式队列；通过ZK修改已订阅的机器的配置


    基本概念：
        集群角色：Leader，Follower，Observer
            leader：选举产生，读/写；所有写都是以leader进行的
            Follower：参与选举，可被选举，读服务；
            Observer：参与选举，不可被选举，提供读服务；

        会话：zk中，分布式中能协调，服务端和每一个客户都会建立一个TCP长连接一之存在，只有客户端出现宕机或者不参与分布式系统系统才会断掉
            如果存在网络故障可以设置 sesslonTimeout

        数据节点(ZNode)：即zk数据模型中的数据单元；zk的数据都存储于内存中，数据模型为树状结构(ZNode Tree);每个ZNode都会保存自己数据于内存中；
            持节节点：仅显示删除才消失
            临时节点：会话中止即自动消失

        版本(version)：ZK会为每个ZNode维护一个称为Stat的数据结构，记录了当前的ZNode的三个数据版本
            version：当前版本
            cversion：当前ZNode的子节点的版本
            aversion：当前ZNode的ACL的版本

        ACL：ZK使用ACL机制进行权限控制
             CREATE,READ,WRITE,DELETE,ADMIN

        事件监听器(Watcher)：一次性的出发通知机制
            ZK上，由用户指定的触发机制，在某些时间产生时，ZK能够将通知给相关的客户端；

    ZAB协议：Zookeeper Atomic Broadcast,zk原子广播协议
        支持崩溃恢复机制，保证leader崩溃后选取新的leader，而且要确保数据的完整性和一致性。


        ZAB协议中存在三种状态：  ZK所有节点状态只会在这三个状态来回转换
            (1)Looking，
            (2)Following，
            (3)Leading
                当leading丢失所有节点会重新回到Looking状态，leader和follower有一个序列的心跳认证来确定存活状态

        四个阶段：
            选举：election
            发现：discovery
            同步：sync
            广播：Broadcast

    下载：http://zookeeper.apache.org
        部署方式：单机模式、伪分布式模式、分布式模式

    安装：
        首先安装java
        再看装zookeeper
        tar -zxf zookeeper-*.tar.gz -C /usr/local
        cd /usr/loacl
        ln -s apache-zookeeper-3.5.5-bin zookeeper
        cd zookeeper/conf
        cp zoo_sample.cfg zoo.cfg

    zoo.cfg配置文参数
        基本配置文件：
            tickTime 连接心态的时长单位为ms
            initLimit  初始同步阶段需经过多少tickTime周期
            syncLimit  发送请求阶段需经过多少tickTime周期
            dataDir       数据目录，建议不放在/tmp目录下，机器重启后会丢失
            clientPort    连接监听端口
            maxClientCnxns    最大并发连接数
            server.1=IP+PORT

        存储配置：
            preALLocSize：为十五日志预先分配的池畔空间量：默认65535KB
            snapCount：每次多少次事务后执行一次快照操作；每事务的平均大小在100字节；
            autopurget.snapRetainCount：
            autopurge.purgeInterval：purge操作的时间间隔，0表示不启动；
            fsync.warningthresholdms：zk进行事务日志fsync操作时消耗的时长报警阈值；
            weight.X=N：判断quorum时投票权限，默认1；

        网络配置：
            maxClientCnxns：每个客户端IP的最大并发连接数
            clientPortAddress：zk监听IP地址;
            minSessionTimeout：
            maxSessionTimeout：

        集群配置：
            initLimit：Follower连入Leader并完成数据同步的时长；
            syncLimit：心跳检测的最大延迟；
            leaderServes：默认zk的leader接收读写请求，额外还要负责协调各Follower发来的事务等；因此，为使得leader几种处理zk集群内部信息，建议不让leader直接提供服务；
            cnxTimeout：leader选举期间，各服务器创建TCP连接的超时时长；
            ellectialg：选举算法，目前仅支持FastLeaderElection算法一种；
            server.id=[hostname]:port:port[:observer]
                集群内各服务器的属性参数
                    第一个port：follower与leader


    zoo.cfg配置参数：
        titckTime=2000
        dataDir=/dta/zookeeper
        ClientPort=2181
        initLimit=5
        syncLimit=2

        指定主机的语法格式：
            server.ID=IP:port:port
                ID:各主机的数字标识，一般从1开始
                IP:各主机的IP

    集群搭建
        在zoo.cfg配置的dataDir目录下建一个myid文件输入一个数字
        例如： echo 1 &gt; /tmp/zookeeper/myid

    服务启停/zookeeper/bin/zkServer.sh
        ./zkServer.sh start
        ./zkServer.sh stop
        ./zkServer.sh -h  查看帮助

    连接
        ./zkCli.sh
        连接后敲？ 列出帮助



    节点信息：stat
        cZxid  创建得事务id
        ctime  创建时间
        mZxid  最近更新该事务得id
        mtime  进行更新时间
        pZxid  该节点的子节点列表更新id
        cversion 子节点版本号
        dataVersion     数据版本号
        aclVersion    acl版本号
        ephemeralOwner    创建该临时节点的会话id
        datalength    数据长度
        numChildren    子节点的个数
        版本号在zk其实是表示相关数据的修改次数，乐观并发，乐观锁，修改是如果又数据会导致回滚


    zkCli命令：
        create，ls，ls2，stat，delete，rmr，get，set，.....

    监控zk的四字命令：
        ruok，stat，srvr，conf，cons,wchs,envi ....

    zoo.cfga</code></pre>
            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls"
                data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
            <ul id="audio-list" style="display:none">
                
                
                <li title='0' data-url='/statics/chengdu.mp3'></li>
                
                    
            </ul>
            
            
            
    <div id='gitalk-container' class="comment link"
        data-ae='true'
        data-ci='ec894e2b66f752e8b7fb'
        data-cs='3ccc2e92bb350688fe2c2dc2930189b62622bfb1'
        data-r='blog-comments'
        data-o='TriDiamond'
        data-a='TriDiamond'
        data-d=''
    >Comments</div>


            
            
        </div>
        <div class="sidebar">
            <div class="box animated fadeInRight">
                <div class="subbox">
                    <img src="https://res.cloudinary.com/tridiamond/image/upload/v1573019751/TriDiamond_logo_ui_xeublz.jpg" height=300 width=300></img>
                    <p>John Doe</p>
                    <span>Think like an artist, develop like an artisan</span>
                    <dl>
                        <dd><a href="https://github.com/TriDiamond" target="_blank"><span
                                    class=" iconfont icon-github"></span></a></dd>
                        <dd><a href="https://twitter.com/TriDiamond6" target="_blank"><span
                                    class=" iconfont icon-twitter"></span></a></dd>
                        <dd><a href="https://stackoverflow.com/users/7602324/tridiamond?tab=profile" target="_blank"><span
                                    class=" iconfont icon-stack-overflow"></span></a></dd>
                    </dl>
                </div>
                <ul>
                    <li><a href="/">4 <p>Articles</p></a></li>
                    <li><a href="/categories">4 <p>Categories</p></a></li>
                    <li><a href="/tags">7 <p>Tags</p></a></li>
                </ul>
            </div>
            
            
            
            
        </div>
    </div>
</div>

    </div>
</div>
    <div id="back-to-top" class="animated fadeIn faster">
        <div class="flow"></div>
        <span class="percentage animated fadeIn faster">0%</span>
        <span class="iconfont icon-top02 animated fadeIn faster"></span>
    </div>
</body>
<footer>
    <p class="copyright" id="copyright">
        &copy; 2020
        <span class="gradient-text">
            John Doe
        </span>.
        Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a>
        Theme
        <span class="gradient-text">
            <a href="https://github.com/TriDiamond/hexo-theme-obsidian" title="Obsidian" target="_blank" rel="noopener">Obsidian</a>
        </span>
        <small><a href="https://github.com/TriDiamond/hexo-theme-obsidian/blob/master/CHANGELOG.md" title="v1.4.3" target="_blank" rel="noopener">v1.4.3</a></small>
    </p>
</footer>

<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script>
  MathJax.Hub.Config({
    "HTML-CSS": {
      preferredFont: "TeX",
      availableFonts: ["STIX", "TeX"],
      linebreaks: {
        automatic: true
      },
      EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
      inlineMath: [
        ["$", "$"],
        ["\\(", "\\)"]
      ],
      processEscapes: true,
      ignoreClass: "tex2jax_ignore|dno",
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      noUndefined: {
        attributes: {
          mathcolor: "red",
          mathbackground: "#FFEEEE",
          mathsize: "90%"
        }
      },
      Macros: {
        href: "{}"
      }
    },
    messageStyle: "none"
  });
</script>
<script>
  function initialMathJax() {
    MathJax.Hub.Queue(function () {
      var all = MathJax.Hub.getAllJax(),
        i;
      // console.log(all);
      for (i = 0; i < all.length; i += 1) {
        console.log(all[i].SourceElement().parentNode)
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  }

  function reprocessMathJax() {
    if (typeof MathJax !== 'undefined') {
      MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
    }
  }
</script>



    <link rel="stylesheet" href="//cdn.bootcss.com/gitalk/1.5.0/gitalk.min.css">
    <script src="//cdn.bootcss.com/gitalk/1.5.0/gitalk.min.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/obsidian.js"></script>
<script src="/js/jquery.truncate.js"></script>
<script src="/js/search.js"></script>
<script src="//cdn.bootcss.com/typed.js/2.0.10/typed.min.js"></script>
<script src="//cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>

<script src="https://cdn.bootcss.com/codemirror/5.48.4/codemirror.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/javascript/javascript.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/css/css.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/xml/xml.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/htmlmixed/htmlmixed.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/clike/clike.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/php/php.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/shell/shell.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/python/python.min.js"></script>



    <script src="/js/busuanzi.min.js"></script>
    <script>
        $(document).ready(function () {
            if ($('span[id^="busuanzi_"]').length) {
                initialBusuanzi();
            }
        });
    </script>


<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>



    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="//www.googletagmanager.com/gtag/js?id=UA-149874671-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-149874671-1');
    </script>





<script>
    function initialTyped () {
        var typedTextEl = $('.typed-text');
        if (typedTextEl && typedTextEl.length > 0) {
            var typed = new Typed('.typed-text', {
                strings: ["Think like an artist, develop like an artisan", "艺术家思维去思考问题，工匠创造精神去开发"],
                typeSpeed: 90,
                loop: true,
                loopCount: Infinity,
                backSpeed: 20,
            });
        }
    }

    if ($('.article-header') && $('.article-header').length) {
        $(document).ready(function () {
            initialTyped();
        });
    }
</script>




</html>
